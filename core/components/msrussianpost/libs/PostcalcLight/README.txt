PostcalcLight - это библиотека для работы с Postcalc.RU и простой веб-интерфейс в одном архиве.


Библиотека легковесная, в сжатом виде - около 80 Кб в архиве, основная функция опроса - менее 40 строк кода. Основные возможности:

1. Проверка аргументов на правильность. Отправитель и получатель проверяются по прилагаемым базам данных в формате 
простых текстовых файлов: postcalc_light_post_indexes.txt и postcalc_light_locations.txt. 
Страна проверяется по файлу postcalc_light_сountries.txt.

2. Правильное перекодирование аргументов.

3. Опрос в цикле доступных серверов проекта Postcalc.RU - если один сервер недоступен, запрашивается следующий.

4. Разархивирование ответа и перевод его в массив PHP.

5. Кэширование правильного ответа.

6. Настройка всех необходимых параметров в конфигурационном файле.

7. Для дизайна была использована тема Start из стандартной библиотеки jQuery UI. 
При желании ее можно заменить на любую другую из 24 тем библиотеки. Для этого отредактируйте
следующую строчку в postcalc_light.php:
<link rel='stylesheet' href='//yandex.st/jquery-ui/1.10.4/themes/start/jquery-ui.min.css' type='text/css' media='screen' />

8. Автодополнение индекса отделения связи и местоположения для полей "Откуда" и "Куда".

9. Javascript необязателен - он используется только в автодополнении и некоторых элементах дизайна.

10. Ведение журналов успешных и неуспешных соединений. Скрипт postcalc_light_stat.php позволяет просматривать статистику 
по месяцам и дням, скрипт postcalc_light_view_log.php - собственно журналы (они разбиты по месяцам).

11. После 10 неуспешных соединений на контактный email отсылается уведомление о сбое (параметр error_log_send).

12. При необходимости - доступ по паролю к статистике (см. postcalc_light_pass в конфигурационном файле).

Использование.

1. Разархивируйте PostcalcLight.zip в каталог веб-сервера.

2. Для проверки откройте в веб-браузере страницу /PostcalcLight/postcalc_light_test.php - она обратится к серверу Postcalc.RU, 
и, если все в порядке, нарисует таблицу.

3. Откройте в веб-браузере страницу /PostcalcLight/postcalc_light.php - это простой клиент для работы с Postcalc.RU.

4. Настройте клиент для ваших нужд - откройте файл postcalc_light_config.php и правильно заполните значение следующих переменных:

st - Название сайта, без http: и слэшей
ml - Контактный email. Самый принципиальный параметр. Обязательно проверьте, доходит ли почта с сервера postcalc.ru:
http://www.postcalc.ru/check_email.php
default_from - Почтовое отделение отправителя по умолчанию.

Также полезно заполнить следующие параметры:
cache_dir - каталог, доступный для записи веб-серверу. Там будут храниться журналы соединений и кэш. 
По умолчанию это /tmp, однако все файлы из этого каталога при перезагрузке вашего сервера автоматически удаляются.
r - округление тарифов, в рублях. По умолчанию 0.01 - т.е. округление до копеек.
pr - единовременная наценка в рублях на заказ.

Также вы можете изменить значение других переменных запроса - их описание имеется в файле postcalc_light_config.php.

5. Следите за работой библиотеки через /PostcalcLight/postcalc_light_stat.php.

=========================================================
ОПИСАНИЕ ФАЙЛОВ

postcalc_light.php - веб-интерфейс к клиентской библиотеке postcalc_light_lib.php. 
postcalc_light_auth.php - форма авторизации. 
postcalc_light_autocomplete.php - поддержка автодополнения для полей "Откуда" и "Куда".
postcalc_light_config.php - конфигурационный файл. Настоятельно рекомендуется прочитать комментарии в нем.
postcalc_light_lib.php - клиентская библиотека. Настоятельно рекомендуется ознакомиться с документацией: http://www.postcalc,ru/doc/PostcalcLight/
postcalc_light_stat.php - статистика по месяцам и дням.
postcalc_light_test.php - простой файл для тестирования.
postcalc_light_view_log.php - просмотр журналов соединений.

postcalc_light_countries.txt - список стран и аббревиатур.
postcalc_light_locations.txt - список местоположений и отделений связи по умолчанию для них.
postcalc_light_post_indexes.txt - список 6-значных индексов отделений связи.

postcalc_light_form_plugin.js - плагин jQuery для поддержки веб-интерфейса.